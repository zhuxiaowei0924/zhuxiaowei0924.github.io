---
title: liunx就该这么学：vim编辑器与Shell命令脚本
date: 2021-01-09 22:53:07
tags:
- 第4章节：vim编辑器与Shell命令脚本
categories:
- linux就该这么学

---
# 1.Vim文本编辑器
注意：在linux系统中一切都是文件，而配置一个服务就是在修改其配置文件的参数；

Vim编辑器有三种模式：

	（1）命令模式：控制光标移动，可对文本进行复制、粘贴、删除和查找等操作（开机后默认进入命令模式）；
	（2）输入模式：正常的文本录入（按a、i、o从命令模式进入输入模式，按Esc键退出输入模式）；
				 a键和i键分别是在光标后一位和光标当前位置切换到输入模式，而o键则是在光标的下面再新建一个空行。
	（3）末行模式：保存或退出文档，以及设置编辑环境（按：键进入末行模式，按Esc键退出输入模式）；

<!--more-->
命令模式中常用的命令：


| 命令 | 作用 |
| --- | --- |
| dd |	删除（剪切）光标所在整行 |
| 5dd |	删除（剪切）从光标处开始的5行 |
| yy |	复制光标所在整行 |
| 5yy |	复制从光标处开始的5行 |
| n | 显示搜索命令定位到的下一个字符串 |
| N | 显示搜索命令定位到的上一个字符串 |
| u | 撤销上一步的操作 |
| p | 将之前删除（dd）或复制（yy）过的数据粘贴到光标后面 |

末行模式中常用的命令：


| 命令 | 作用 |
| --- | --- |
| :w |	保存 |
| :q |	退出
| :q! |	强制退出（放弃对文档的修改内容）
| :wq! |	强制保存退出
| :set nu |	显示行号
| :set nonu |	不显示行号
| :命令 |	执行该命令
| :整数 |	跳转到该行
| :s/one/two |	将当前光标所在行的第一个one替换成two
| :s/one/two/g	|将当前光标所在行的所有one替换成two
| :%s/one/two/g |	将全文中的所有one替换成two
| ?字符串 |	在文本中从下至上搜索该字符串
| /字符串 |	在文本中从上至下搜索该字符串

# 2.配置主机名称

1.使用Vim编辑器修改“/etc/hostname”中的主机名称，将原始主机名称删除后追加“想加入的主机名称”，修改完毕后记得在末行模式下输入：wq！命令保存文档；  
2.使用hostname命令检查是否修改成功；  

注意：修改完毕后，有时主机名称不会立即同步到系统中，可重启虚拟机；  

# 3.配置网卡信息

网卡IP地址配置的是否正确是两台服务器是否可以相互通信的前提；  

网卡信息配置步骤：  

	1.cd /etc/sysconfig/network-scripts （存放着网卡的配置文件)；
	2.用Vim编辑器修改网卡文件ifcfg-eno16777728（每台仪器的网卡名称不一样，需要用ifconfig命令进行查询）；  
		
		-设备类型：TYPE=Ethernet
		-地址分配模式：BOOTPROTO=static
		-网卡名称：NAME=eno16777728
		-设备名称：DEVICE=eno1677728（不输入设备名称，在重启网卡时有报错，不太清楚原因）
		-是否启动：ONBOOT=yes
		-IP地址：IPADDR=192.168.10.10
		-子网掩码：NETMASK=255.255.255.0
		-网关地址：GATEWAY=192.168.10.1
		-DNS地址：DNS1=192.168.10.1
	
	3.重启网络服务并测试网络是否联通：systemctl restart network     ping 192.168.10.10

# 4.配置Yum软件仓库

配置YUM软件仓库的步骤如下：

	1.cd /etc/yum.repos.d/ （存放Yum软件仓库的配置文件）；
	2.vim rhel7.repo的配置文件（文件名称随意，但后缀必须为.repo），在配置文件中写入下方的配置参数：
		[rhel7] （Yum软件仓库唯一标识符，避免与其他仓库冲突）
		name=rhel7 （Yum软件仓库的名称描述，易于识别仓库用处）
		baseurl=file:///media/cdrom （提供的方式包括FTP（ftp://..）、HTTP（http://..）、本地（file:///..））
		enabled=1 （设置此源是否可用；1为可用，0为禁用）
		gpgcheck=0 （设置此源是否校验文件；1为校验，0为不校验）
	3.挂载光盘，并把光盘挂载信息写入到/etc/fstab文件中；
	4.使用“yum install httpd -y”检查Yum软件仓库是否可用

# 5.编写Shell脚本

Shell脚本内容可分为三部分：

		
	1.第一行的#！/bin/bash：用于告诉系统用哪种Shell解释器来执行该脚本；
	2.第二行的#：是注释信息，用于对脚本功能和某些命令的介绍信息；
	3.第三行之后的内容是可执行语句。

## 5.1 接受用户参数

Shell脚本语言内置了用于接收参数的变量，变量之间使用空格间隔；如：$0对应当前Shell脚本名称，$#对应总共几个参数，$*对应所有位置的参数值，$？对应显示上一次命令的执行返回值，而$1、$2、$3...分别对应第N个位置的参数值。

## 5.2 判断用户的参数

条件测试语句格式： [ 条件表达式 ]  两边各有一个空格

条件测试语句分为4种：文件测试语句、逻辑测试语句、整数值比较语句、字符串比较语句。

文件测试所用参数：


| 操作符 | 作用 |
| --- | --- |
| -d | 文件是否为目录 |
| -e | 文件是否存在 |
| -f | 文件是否为一般文件 |
| -r | 当前用户是否有权限读取 |
| -w | 当前用户是否有权限写入 |
| -x | 当前用户是否有权限执行 |


	[root@linuxprobe ~]# [ -d /etc/fstab ]
	[root@linuxprobe ~]# echo $?
	1（返回值如果为0，表示目录存在；为非零值，则表示目录不存在）

逻辑语句运算符号：与（&&）、或（||）、非（！）；

&&：表示当前面的命令执行成功后才能执行后面的命令；
||：表示当前面的命令执行失败后才能执行后面的命令；
！：表示把条件测试中的判断结果取相反值。

整数比较运算符仅是对数字的操作，不能将数字与字符串、文件等内容一起操作，而且不能想当然地使用日常生活中的等号、大于号、小于号等来判断。


| 操作符 | 作用 |
| --- | --- |
| -eq | 是否等于 |
| -ne | 是否不等于 |
| -gt | 是否大于 |
| -lt | 是否小于 |
| -le | 是否等于或小于 |
| -ge | 是否大于或等于 |


	[root@linuxprobe ~]# [ 10 -gt 10 ]
	[root@linuxprobe ~]# echo $?
	1
	[root@linuxprobe ~]# [ 10 -eq 10 ]
	[root@linuxprobe ~]# echo $?
	0

字符串比较语句用于判断测试字符串是否为空值，或两个字符串是否相同。


| 操作符 | 作用 |
| = | 比较字符串内容是否相同 |
| ！= | 比较字符串内容是否不同 |
| -z |  判断字符串内容是否为空 |

## 5.3 流程控制语句

1.if条件测试语句：可以让脚本根据实际情况自动执行相应的命令。从技术角度来讲，if语句分为单分支结构、双分支结构、多分支结构；

	（1）
	if 条件测试操作
	then 命令序列
	fi

	（2）
	if 条件测试操作
	then 命令序列1
	else 命令序列2
	fi

	（2）
	if 条件测试操作
	then 命令序列1
	elif 条件测试操作2
		then 命令序列2
	else 命令序列2
	fi

2.for条件循环语句：允许脚本一次性读取多个信息，然后逐一对信息进行操作处理，当要处理的数据有范围时，使用for循环语句再适合不过了。

	for 变量名 in 取值列表
	do
	命令序列
	done

3.while条件循环语句：通过判断条件测试的真假来决定是否继续执行命令，若条件为真就继续执行，为假就结束循环。

	while 条件测试操作
	do
		命令序列
	done

4.case条件测试语句：case语句是在多个范围内匹配数据，若匹配成功则执行相关命令并结束整个条件测试；而如果数据不在所列出的范围内，则会去执行星号（*）中所定义的默认命令。

	case 变量值 in
	模式1）
		命令序列1
		;;
	模式2）
		命令序列2
		;;
		……
	*）
		默认命令序列
	esac

5.计划任务服务程序

分为一次性计划任务和长期性计划任务；

一次性计划任务：写成“ at 时间 ”的形式，如果想要查看已设置好但还未执行的一次性计划任务，可以使用“at -l”命令；要想将其删除，可以用“atrm 任务序号”。

长期性计划任务：默认启用crond服务；创建、编辑计划任务的命令为“crontab -e”，查看当前计划任务的命令为“crontab -l”，删除某条计划任务的命令为“crontab -r”。口诀：“分、时、日、月、星期 命令”

注意：
（1）在crond服务的计划任务参数中，所有命令一定要用绝对路径的方式来写，如果不知道绝对路径，请用whereis命令进行查询。
（2）计划任务中的“分”字段必须有数值，绝对不能为空或是*号，而“日”和“星期”字段不能同时使用，否则就会发生冲突。